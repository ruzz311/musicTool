!function(){"use strict";function a(a,b){return[a[0]+b[0],a[1]+b[1]]}function b(a,b){return[a[0]-b[0],a[1]-b[1]]}function c(a,b){return"number"==typeof b?[a[0]*b,a[1]*b]:[a[0]*b[0],a[1]*b[1]]}function d(a){return a[0]+a[1]}function e(a,b,c){for(;c>0;c--)a+=b;return a}function f(a,b){b=b||{},this.duration={value:b.value||4,dots:b.dots||0},this.coord=a}function g(a){this.coord=a}function h(a,b){function c(a){for(var b=0,c=a.length;c>b;b++)m[b+1]=a[b];n=a.length}b=b||"",this.name=a.name().toUpperCase()+a.accidental()+b,this.symbol=b,this.root=a,this.intervals=[],this._voicing=[];var d,e,f,g,h,i,k="quality",l=[],m=["P1","M3","P5","m7","M9","P11","M13"],n=2;for(b=b.replace(/[,\s\(\)]/g,""),h=b.split("/"),2===h.length?(b=h[0],h=h[1]):h=null,d=0,e=b.length;e>d&&(f=b[d]);d++){switch(k){case"quality":g=e>=d+3?b.substr(d,3).toLowerCase():null,i=g in v?g:f in v?f:"",c(v[i]),d+=i.length-1,k="extension";break;case"extension":if(f="1"===f&&b[d+1]?parseFloat(b.substr(d,2)):parseFloat(f),isNaN(f)||6===f)6===f?(m[3]="M6",n=3>n?3:n):d-=1;else{if(n=(f-1)/2,n!==Math.round(n))throw new Error("Invalid interval extension: "+f.toString(10));("o"===i||"dim"===i)&&(m[3]="d7"),d+=String(f).length-1}k="alterations";break;case"alterations":var o,p=b.substr(d).split(/(#|b|add|maj|sus|M)/i),q=!1,r=!1;if(1===p.length)throw new Error("Invalid alterations");if(0!==p[0].length)throw new Error("Invalid token: '"+p[0]+"'");for(var s=1,t=p.length;t>s;s++)switch(o=p[s+1],p[s]){case"M":case"Maj":case"maj":n=3>n?3:n,"7"===o&&s++,m[3]="M7";break;case"Sus":case"sus":var u="P4";("2"===o||"4"===o)&&(s++,"2"===o&&(u="M2")),m[1]=u;break;case"Add":case"add":o&&!isNaN(+o)&&("9"===o?l.push("M9"):"11"===o?l.push("P11"):"13"===o&&l.push("M13"),s+=o.length);break;case"b":q=!0;break;case"#":r=!0;break;default:if(0===p[s].length)break;var w,x,y=+p[s];if(isNaN(y)||String(y).length!==p[s].length)throw new Error("Invalid token: '"+p[s]+"'");if(6===y){m[3]=r?"A6":q?"m6":"M6",n=3>n?3:n;continue}if(x=(y-1)/2,x>n&&(n=x),5>y||7===y||x!==Math.round(x))throw new Error("Invalid interval alteration: "+y);w=m[x][0],r?"d"===w?w="m":"m"===w?w="M":("M"===w||"P"===w)&&(w="A"):q&&("A"===w?w="M":"M"===w?w="m":("m"===w||"P"===w)&&(w="d")),r=q=!1,m[x]=w+y}k="ended"}if("ended"===k)break}for(h&&"9"===h&&(l.push("M9"),h=null),this.intervals=m.slice(0,n+1).concat(l).map(function(a){return j.interval(a)}),d=0,e=this.intervals.length;e>d;d++)this._voicing[d]=this.intervals[d];if(h){var z,A,B=this.intervals;for(A=j.note(h+(a.octave()+1)),z=j.interval.between(a,A),h=z.simple(),z=z.invert(),z.direction("down"),this._voicing=[z],d=0;e>d;d++)B[d].simple()!==h&&this._voicing.push(B[d])}}function i(a,b){var c,d;if(!(a instanceof f))throw new Error("Invalid Tonic");if("string"==typeof b){if(c=b,b=j.scale.scales[b],!b)throw new Error("Invalid Scale")}else for(d in j.scale.scales)if(j.scale.scales.hasOwnProperty(d)&&j.scale.scales[d].toString()===b.toString()){c=d;break}this.name=c,this.tonic=a,this.scale=b}var j={},k={c:[0,0],d:[-1,2],e:[-2,4],f:[1,-1],g:[0,1],a:[-1,3],b:[-2,5],h:[-2,5]},l={unison:[0,0],second:[3,-5],third:[2,-3],fourth:[1,-1],fifth:[0,1],sixth:[3,-4],seventh:[2,-2],octave:[1,0]},m=["second","sixth","third","seventh","fourth","unison","fifth"],n=["unison","second","third","fourth","fifth","sixth","seventh","octave","ninth","tenth","eleventh","twelfth","thirteenth","fourteenth","fifteenth"],o=["f","c","g","d","a","e","b"],p=["bb","b","","#","x"],q=[-4,7],r=a(k.a,[4,0]),s={.25:"longa",.5:"breve",1:"whole",2:"half",4:"quarter",8:"eighth",16:"sixteenth",32:"thirty-second",64:"sixty-fourth",128:"hundred-twenty-eighth"},t={P:"perfect",M:"major",m:"minor",A:"augmented",AA:"doubly augmented",d:"diminished",dd:"doubly diminished"},u={perfect:["dd","d","P","A","AA"],minor:["dd","d","m","M","A","AA"]},v={min:["m3","P5"],m:["m3","P5"],"-":["m3","P5"],M:["M3","P5"],"":["M3","P5"],"+":["M3","A5"],aug:["M3","A5"],dim:["m3","d5"],o:["m3","d5"],maj:["M3","P5","M7"],dom:["M3","P5","m7"],Ã¸:["m3","d5","m7"],5:["P5"]},w={major:"M",minor:"m",augmented:"aug",diminished:"dim","half-diminished":"7b5",power:"5",dominant:"7"},x={unison:1,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,octave:8,ninth:9,eleventh:11,thirteenth:13},y={dd1:"daw",d1:"de",P1:"do",A1:"di",AA1:"dai",d2:"raw",m2:"ra",M2:"re",A2:"ri",AA2:"rai",d3:"maw",m3:"me",M3:"mi",A3:"mai",dd4:"faw",d4:"fe",P4:"fa",A4:"fi",AA4:"fai",dd5:"saw",d5:"se",P5:"so",A5:"si",AA5:"sai",d6:"law",m6:"le",M6:"la",A6:"li",AA6:"lai",d7:"taw",m7:"te",M7:"ti",A7:"tai",dd8:"daw",d8:"de",P8:"do",A8:"di",AA8:"dai"};j.note=function(a,b){return"string"==typeof a?j.note.fromString(a,b):new f(a,b)},j.note.fromKey=function(e){var f=Math.floor((e-4)/12),g=e-12*f-4,h=o[(2*Math.round(g/2)+1)%7],i=a(b(k[h],r),[f+1,0]),l=e-49-d(c(i,[12,7]));return j.note(l?a(i,c(q,l)):i)},j.note.fromFrequency=function(a,b){var c,d,e;return b=b||440,c=49+12*((Math.log(a)-Math.log(b))/Math.log(2)),c=Math.round(c),e=b*Math.pow(2,(c-49)/12),d=1200*(Math.log(a/e)/Math.log(2)),{note:j.note.fromKey(c),cents:d}},j.note.fromMIDI=function(a){return j.note.fromKey(a-20)},j.note.fromString=function(d,e){var g,h,i,j,l,m,n=/^([a-h])(x|#|bb|b?)(-?\d*)/i,o=/^([a-h])(x|#|bb|b?)([,\']*)$/i;if(g=d.match(n),g&&d===g[0]&&g[3].length)h=g[1],i=+g[3];else{if(d=d.replace(/\u2032/g,"'").replace(/\u0375/g,","),g=d.match(o),!g||d!==g[0])throw new Error("Invalid note format");if(h=g[1],i=g[3],m=h===h.toLowerCase(),i.length)if(i.match(/^'+$/)&&m)i=3+i.length;else{if(!i.match(/^,+$/)||m)throw new Error("Format must respect the Helmholtz format");i=2-i.length}else i=m?3:2}return j=g[2].length?g[2].toLowerCase():"",h=h.toLowerCase(),l=[k[h][0],k[h][1]],l=a(l,[i,0]),l=a(l,c(q,p.indexOf(j)-2)),new f(b(l,r),e)},j.chord=function(a,b){if("string"==typeof a){var c,d;if(c=a.match(/^([a-h])(x|#|bb|b?)/i),c&&c[0])return d="number"==typeof b?b.toString(10):"4",new h(j.note(c[0].toLowerCase()+d),a.substr(c[0].length))}else if(a instanceof f)return new h(a,b);throw new Error("Invalid Chord. Couldn't find note name")},j.interval=function(a,b){if("string"==typeof a)return j.interval.toCoord(a);if("string"==typeof b&&a instanceof f)return j.interval.from(a,j.interval.toCoord(b));if(b instanceof f&&a instanceof f)return j.interval.between(a,b);throw new Error("Invalid parameters")},j.interval.toCoord=function(b){var d,e,f,h,i,j,k,m,o,p,r=/^(AA|A|P|M|m|d|dd)(-?\d+)$/;if(d=b.match(r),!d)throw new Error("Invalid simple format interval");if(h=d[1],e=+d[2],p=0>e,e=p?-e:e,i=e>8?e%7?e%7:7:e,j=(e-i)/7,k=l[n[i-1]],f=a(k,[j,0]),m=k[0]<=1?"perfect":"minor","perfect"===m&&("M"===h||"m"===h)||"minor"===m&&"P"===h)throw new Error("Invalid interval quality");return o=u[m].indexOf(h)-2,f=a(f,c(q,o)),f=p?c(f,-1):f,new g(f)},j.interval.from=function(b,c){return new f(a(b.coord,c.coord))},j.interval.between=function(a,c){return new g(b(c.coord,a.coord))},j.interval.invert=function(a){return j.interval(a).invert().toString()},j.scale=function(a,b){return a instanceof f||(a=j.note(a)),new i(a,b)},j.scale.scales={},f.prototype={octave:function(){return this.coord[0]+r[0]-k[this.name()][0]+4*this.accidentalValue()},name:function(){return o[this.coord[1]+r[1]-7*this.accidentalValue()+1]},accidentalValue:function(){return Math.round((this.coord[1]+r[1]-2)/7)},accidental:function(){return p[this.accidentalValue()+2]},key:function(a){return a?7*this.coord[0]+4*this.coord[1]+29:12*this.coord[0]+7*this.coord[1]+49},fq:function(a){return a=a||440,a*Math.pow(2,(12*this.coord[0]+7*this.coord[1])/12)},chroma:function(){var a=(d(c(this.coord,[12,7]))-3)%12;return 0>a?a+12:a},scale:function(a){return j.scale(this,a)},interval:function(a){return j.interval(this,a)},transpose:function(a){var b=j.interval(this,a);return this.coord=b.coord,this},chord:function(a){return a=a in w?w[a]:a,new h(this,a)},helmholtz:function(){var a=this.octave(),b=this.name();b=3>a?b.toUpperCase():b.toLowerCase();var c=3>a?",":"'",d=2>a?2-a:a-3;return e(b+this.accidental(),c,d)},scientific:function(){return this.name().toUpperCase()+this.accidental()+this.octave()},enharmonics:function(b){var d=this.key(),e=b?2:3;return["m3","m2","m-2","m-3"].map(this.interval.bind(this)).filter(function(b){var f=b.accidentalValue(),g=d-(b.key()-f);return e>g&&g>-e?(b.coord=a(b.coord,c(q,g-f)),!0):void 0})},solfege:function(a,b){if(!(a instanceof i))throw new Error("Invalid Scale");var c,d,f,g=a.tonic.interval(this);return"down"===g.direction()&&(g=g.invert()),b&&(f=(this.key(!0)-a.tonic.key(!0))/7,f=f>=0?Math.floor(f):-Math.ceil(-f),d=f>=0?"'":","),c=y[g.simple(!0)],b?e(c,d,Math.abs(f)):c},durationName:function(){return s[this.duration.value]},durationInSeconds:function(a,b){var c=60/a/(this.duration.value/4)/(b/4);return 2*c-c/Math.pow(2,this.duration.dots)},scaleDegree:function(a){var b=a.tonic.interval(this),c=b.number();return b="down"===b.direction()||c>7&&0===(c-1)%7?b.invert():b,a.scale.indexOf(b.simple(!0))+1},toString:function(a){return this.name()+this.accidental()+(a?"":this.octave())}},g.prototype={name:function(){return n[this.number()-1]},semitones:function(){return d(c(this.coord,[12,7]))},number:function(){return Math.abs(this.value())},value:function(){var a,d,e=b(this.coord,c(q,Math.floor((this.coord[1]-2)/7)+1));return a=m[e[1]+5],d=x[a]+7*(e[0]-l[a][0]),d>0?d:d-2},type:function(){return l[this.base()][0]<=1?"perfect":"minor"},base:function(){var a,d=b(this.coord,c(q,this.qualityValue()))[1];return d=this.value()>0?d+5:-(d-5)%7,d=0>d?m.length+d:d,a=m[d],"unison"===a&&this.number()>=8&&(a="octave"),a},direction:function(a){if(a){var b=this.value()>=1?"up":"down";return b!==a&&(this.coord=c(this.coord,-1)),this}return this.value()>=1?"up":"down"},simple:function(a){var b=this.value();return b=b>8||-8>b?b%7?b%7:7:b,this.quality()+(a?Math.abs(b):b)},compound:function(a){var b=a?this.number():this.value();return this.quality()+b},isCompound:function(){return this.number()>8},octaves:function(){var a=b(this.coord,c(q,this.qualityValue())),d=a[0]-l[this.base()][0];return d},invert:function(){var b=this.base(),d=this.qualityValue(),e="minor"===this.type()?-(d-1):-d,f=l[n[9-x[b]-1]];return f=a(f,c(q,e)),new g(f)},quality:function(a){var b=u[this.type()][this.qualityValue()+2];return a?t[b]:b},qualityValue:function(){return"down"===this.direction()?Math.floor((-this.coord[1]-2)/7)+1:Math.floor((this.coord[1]-2)/7)+1},equal:function(a){return 0===d(b(this.coord,a.coord))},greater:function(a){var b=this.semitones(),c=a.semitones();return b===c?this.number()>a.number():b>c},smaller:function(a){return!this.equal(a)&&!this.greater(a)},toString:function(){return this.compound()}},h.prototype={notes:function(){for(var a=this.voicing(),b=[],c=0,d=a.length;d>c;c++)b.push(j.interval.from(this.root,a[c]));return b},voicing:function(a){if(!a)return this._voicing;this._voicing=[];for(var b=0,c=a.length;c>b;b++)this._voicing[b]=j.interval(a[b]);return this},resetVoicing:function(){this._voicing=this.intervals},dominant:function(a){return a=a||"",new h(this.root.interval("P5"),a)},subdominant:function(a){return a=a||"",new h(this.root.interval("P4"),a)},parallel:function(a){a=a||"";var b=this.quality();if("triad"!==this.chordType()||"diminished"===b||"augmented"===b)throw new Error("Only major/minor triads have parallel chords");return"major"===b?new h(this.root.interval("m3","down"),"m"):new h(this.root.interval("m3","up"))},quality:function(){for(var a,b,c,d=this.intervals,e=0,f=d.length;f>e;e++)3===d[e].number()?a=d[e]:5===d[e].number()?b=d[e]:7===d[e].number()&&(c=d[e]);return a?(a="down"===a.direction()?a.invert():a,a=a.simple(),b&&(b="down"===b.direction?b.invert():b,b=b.simple()),c&&(c="down"===c.direction?c.invert():c,c=c.simple()),"M3"===a?"A5"===b?"augmented":"P5"===b?"m7"===c?"dominant":"major":"major":"m3"===a?"P5"===b?"minor":"d5"===b?"m7"===c?"half-diminished":"diminished":"minor":void 0):void 0},chordType:function(){var a,b,c,d,e,f=this.intervals.length;if(2===f)return"dyad";if(3===f){for(b={first:!1,third:!1,fifth:!1},d=0;f>d;d++)a=this.intervals[d],c=a.invert(),a.base()in b?b[a.base()]=!0:c.base()in b&&(b[c.base()]=!0);e=b.first&&b.third&&b.fifth?"triad":"trichord"}else if(4===f){for(b={first:!1,third:!1,fifth:!1,seventh:!1},d=0;f>d;d++)a=this.intervals[d],c=a.invert(),a.base()in b?b[a.base()]=!0:c.base()in b&&(b[c.base()]=!0);b.first&&b.third&&b.fifth&&b.seventh&&(e="tetrad")}return e||"unknown"},get:function(a){if("string"==typeof a&&a in x){var b,c,d=this.intervals;for(a=x[a],b=0,c=d.length;c>b;b++)if(d[b].number()===a)return j.interval.from(this.root,d[b]);return null}throw new Error("Invalid interval name")},interval:function(a){return new h(this.root.interval(a),this.symbol)},transpose:function(a){return this.root.transpose(a),this.name=this.root.name().toUpperCase()+this.root.accidental()+this.symbol,this},toString:function(){return this.name}},i.prototype={notes:function(){for(var a=[],b=0,c=this.scale.length;c>b;b++)a.push(j.interval(this.tonic,this.scale[b]));return a},simple:function(){return this.notes().map(function(a){return a.toString(!0)})},type:function(){var a=this.scale.length-2;return 8>a?["di","tri","tetra","penta","hexa","hepta","octa"][a]+"tonic":void 0},get:function(a){return a="string"==typeof a&&a in x?x[a]:a,this.tonic.interval(this.scale[a-1])},solfege:function(a,b){return a?this.get(a).solfege(this,b):this.notes().map(function(a){return a.solfege(this,b)})},interval:function(a){return new i(this.tonic.interval(a),this.scale)},transpose:function(a){var b=this.interval(a);return this.scale=b.scale,this.tonic=b.tonic,this}},j.scale.scales.ionian=j.scale.scales.major=["P1","M2","M3","P4","P5","M6","M7"],j.scale.scales.dorian=["P1","M2","m3","P4","P5","M6","m7"],j.scale.scales.phrygian=["P1","m2","m3","P4","P5","m6","m7"],j.scale.scales.lydian=["P1","M2","M3","A4","P5","M6","M7"],j.scale.scales.mixolydian=["P1","M2","M3","P4","P5","M6","m7"],j.scale.scales.aeolian=j.scale.scales.minor=["P1","M2","m3","P4","P5","m6","m7"],j.scale.scales.locrian=["P1","m2","m3","P4","d5","m6","m7"],j.scale.scales.majorpentatonic=["P1","M2","M3","P5","M6"],j.scale.scales.minorpentatonic=["P1","m3","P4","P5","m7"],j.scale.scales.chromatic=j.scale.scales.harmonicchromatic=["P1","m2","M2","m3","M3","P4","A4","P5","m6","M6","m7","M7"],j.scale.scales.blues=["P1","m3","P4","A4","P5","m7"],j.scale.scales.flamenco=["P1","m2","M3","P4","P5","m6","M7"],j.TeoriaNote=f,j.TeoriaChord=h,j.TeoriaScale=i,j.TeoriaInterval=g,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports.teoria=j):"undefined"!=typeof this?this.teoria=j:"undefined"!=typeof window&&(window.teoria=j)}();